@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "X Şirketi";
}

<h3 style="margin-bottom: 20px;">X Şirketi Genel Organizasyon Şeması</h3>
<div id="treeDiagram" style="width: 100%; height: 600px; border: 1px solid gray;"></div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gojs/2.3.15/go.js"></script>

    <script>
        async function loadChartFromServer() {
            const response = await fetch('/OrgChart/GetChartData');
            const nodeDataArray = await response.json();

            const $ = go.GraphObject.make;
            const myDiagram = $(go.Diagram, "treeDiagram", {
                layout: $(go.TreeLayout, {
                    angle: 90,
                    alignment: go.TreeLayout.AlignmentCenterChildren,
                    layerSpacing: 25,
                    nodeSpacing: 15
                }),
                initialAutoScale: go.Diagram.Uniform
            });

            myDiagram.nodeTemplate =
                $(go.Node, "Auto",
                    $(go.Shape, "RoundedRectangle", { fill: "lightblue", width: 60, height: 180 }),
                    $(go.TextBlock, {
                        margin: 10,
                        font: "bold 12px sans-serif",
                        stroke: "black",
                        wrap: go.TextBlock.WrapFit,
                        width: 160,
                        angle: 270,
                        textAlign: "center"
                    }, new go.Binding("text", "text"))
                );

            myDiagram.model = new go.TreeModel(nodeDataArray);
        }

        window.addEventListener("DOMContentLoaded", loadChartFromServer);
    </script>
}
